syntax = "v1"

info(
	title: "用户中心服务"
	desc: "用户中心服务"
	version: "v1"
)
// Need login
@server(
	prefix: api/v1
	group: user
	jwt: JwtAuth
)
service main{
	@doc "Get User Info Detail"
	@handler detail
	get /user/detail (UserInfoReq) returns (UserInfoResp)

	@doc "Update User Avatar"
	@handler UpdateAvatar
	post  /user/avatar (UpdateAvatarReq) returns (UpdateAvatarResp)
}

//no need login
@server(
	prefix: api/v1
	group: user
)
service main {
	@doc "Register User"
	@handler register
	post /user/register (RegisterReq) returns (RegisterResp)

	@doc "Login User"
	@handler login
	post /user/login (LoginReq) returns (LoginResp)
}

type User {
	ID        int64  `json:"id"`
	Phone     string `json:"phone"`
	NickName  string `json:"nick_name"`
	Sex       int64  `json:"sex"`
	AvatarUrl string `json:"avatar_url"`
	Info      string `json:"info"`
}

type (
	RegisterReq {
		Phone    string `json:"phone" validate:"e164,required"`
		Password string `json:"password" validate:"required"`
		NickName string `json:"nick_name,option"`
	}
	RegisterResp {
		AccessToken  string `json:"access_token"`
		AccessExpire int64  `json:"access_expire"`
		RefreshAfter int64  `json:"refresh_after"`
	}
)

type (
	LoginReq {
		Phone    string `json:"phone"`
		Password string `json:"password"`
	}
	LoginResp {
		AccessToken  string `json:"access_token"`
		AccessExpire int64  `json:"access_expire"`
		RefreshAfter int64  `json:"refresh_after"`
	}
)

type (
	UserInfoReq {
	}
	UserInfoResp {
		UserInfo User `json:"user_info"`
	}
)

type (
	UpdateAvatarReq {
		// image must be base64 encoded
		Image string `json:"image" binding:"Required"`
	}
	UpdateAvatarResp {
	}
)

